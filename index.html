<body>
  Alan's Twitch analysis tool

  <div id="preauthorized">
    <a href="" id="authorize">Connect with Twitch</a>
  </div>

  <div id="authorized" style="display: block">
    Congrats
    <div>
      The top game is <span id="topgame"></span>
    </div>
  </div>

  <script type="text/javascript">
    var client_id = "x6juv2f95gdvktkvae8xhw1llrat1x";
    var redirect_uri = "https://alanoctavius.github.io/";

    document
      .getElementById("authorize")
      .setAttribute(
        "href",
        "https://id.twitch.tv/oauth2/authorize?client_id=" +
          client_id +
          "&redirect_uri=" +
          encodeURIComponent(redirect_uri) +
          "&response_type=token"
      );

    if (document.location.hash && document.location.hash != "") {
      console.log("connected");
      var parsedHash = new URLSearchParams(window.location.hash.slice(1));
      if (parsedHash.get("access_token")) {
        var access_token = parsedHash.get("access_token");
      }

      fetch("https://api.twitch.tv/helix/games/top", {
        header: {
          "Client-ID": client_id,
          Authorization: "Bearer" + access_token,
        },
      })
        .then((response) => reponse.json())
        .then((response) => {
          document.getElementById('topgame').textContent = reposnse.data[0].name
        });
    } else {
      document.getElementById("authorized").style.display = "none";
      document.getElementById("preauthorized").style.display = "block";
    }
  </script>
</body>
